<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting Started with Socraticqs2 Development &mdash; Socraticqs2 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Socraticqs2 0.1 documentation" href="index.html" />
    <link rel="next" title="Writing Guided Activities (Finite State Machines)" href="fsm.html" />
    <link rel="prev" title="Welcome to Socraticqs2’s documentation!" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="fsm.html" title="Writing Guided Activities (Finite State Machines)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to Socraticqs2’s documentation!"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Socraticqs2 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="getting-started-with-socraticqs2-development">
<h1>Getting Started with Socraticqs2 Development<a class="headerlink" href="#getting-started-with-socraticqs2-development" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installation-and-setup">
<h2>Installation and setup<a class="headerlink" href="#installation-and-setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="recommended-use-virtualenv-to-create-an-isolated-test-environment">
<h3>Recommended: use virtualenv to create an isolated test environment<a class="headerlink" href="#recommended-use-virtualenv-to-create-an-isolated-test-environment" title="Permalink to this headline">¶</a></h3>
<p>I find it convenient to isolate my development environment from
any other Python installation, by using virtualenv.
To create an empty virtualenv (replace the path with whatever you want):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">virtualenv</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">put</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">new</span><span class="o">/</span><span class="n">ve</span>
</pre></div>
</div>
<p>To start working with this virtualenv in a given terminal session
(either to install pip packages into it as below, or to actually use it),
type (again replace the path with what you used in the previous step):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">source</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">put</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">new</span><span class="o">/</span><span class="n">ve</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
</div>
<div class="section" id="pre-requisites">
<h3>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h3>
<p>To run the Socraticqs2 development/test server on your computer,
you need various things such as:</p>
<ul class="simple">
<li><strong>Python 2.7</strong></li>
<li><strong>Git</strong>: we use Git as our version control; if you don&#8217;t already have it,
you can download either Github for Windows or Github for Mac;
most linux package managers can install Git for you automatically.
See further details below.</li>
<li><strong>PostgreSQL</strong>: back-end database for Socraticqs2.  See further details below.</li>
<li><strong>Pandoc</strong> (currently used for converting text to HTML): you can download
this for Mac OS X; most linux package managers can install it automatically.</li>
<li><strong>Python packages</strong> automatically installable by pip using our
<cite>dev_requirements.txt</cite> requirements file:
e.g. Django, pypandoc, django-crispy-forms,
wikipedia etc.  This is described in detail below.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>On Ubuntu-like distros, you must first install some dependencies
of the python lxml package, <em>before</em> running <cite>pip install</cite> below:</p>
<div class="last highlight-python"><div class="highlight"><pre>sudo apt-get install libxml2-dev libxslt1-dev python-dev zlib1g-dev
</pre></div>
</div>
</div>
</div>
<div class="section" id="installing-git-version-control-software">
<h3>Installing Git version control software<a class="headerlink" href="#installing-git-version-control-software" title="Permalink to this headline">¶</a></h3>
<p>We use <a class="reference external" href="http://www.git-scm.com">Git</a> and
<a class="reference external" href="https://github.com">GitHub</a> for working on Socraticqs2 development.
You&#8217;ll first need to get Git:</p>
<ul class="simple">
<li>for Windows and Mac, you can download it from
<a class="reference external" href="http://www.git-scm.com">the Git website</a> (command-line interface,
recommended).  We also recommend installing a graphical
interface for viewing Git code revision history such as
<a class="reference external" href="http://www.sourcetreeapp.com">SourceTree</a>.</li>
<li>Alternatively, you can download the
GitHub for Windows / Mac app from GitHub (more limited, in our humble
opinion).</li>
<li>On Linux, your package manager can install (and update) Git
for you automatically.  We recommend installing both the command
line tools (<code class="docutils literal"><span class="pre">git</span></code>) and a graphical interface (<code class="docutils literal"><span class="pre">gitg</span></code>).</li>
</ul>
<p>If you are not accustomed to using Git / GitHub as your primary version
control system, we suggest you review our <a class="reference internal" href="gitguide.html"><em>Git Usage Guide</em></a>.</p>
</div>
<div class="section" id="getting-the-socraticqs2-source-code">
<h3>Getting the Socraticqs2 source code<a class="headerlink" href="#getting-the-socraticqs2-source-code" title="Permalink to this headline">¶</a></h3>
<p>To get your own copy of the Socraticqs2 code,
first go to our Github repository
<a class="reference external" href="https://github.com/cjlee112/socraticqs2">https://github.com/cjlee112/socraticqs2</a>
and Fork the repository (you&#8217;ll need a Github account to do this).
This creates your own repository in your Github account, which you
can make changes to, and issue pull requests for us to incorporate
your changes.  Next clone the repository to your local computer,
one of two ways:</p>
<ul>
<li><p class="first"><strong>via the command line</strong>: click the &#8220;HTTPS clone URL&#8221; <em>copy to clipboard</em>
button on your GitHub repository page, and paste it into a terminal
command like so (substitute your correct clone URL):</p>
<div class="highlight-python"><div class="highlight"><pre>git clone https://github.com/YOURNAME/socraticqs2.git
</pre></div>
</div>
<p>This will clone the repository to a new directory <code class="docutils literal"><span class="pre">socraticqs2/</span></code>
in your current directory.  We recommend you also add our main
repository as a &#8220;remote&#8221; repository called <code class="docutils literal"><span class="pre">upstream</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>cd socraticqs2
git remote add upstream https://github.com/cjlee112/socraticqs2.git
</pre></div>
</div>
</li>
<li><p class="first"><strong>via Github for Windows or Mac</strong>: you can just click the Clone to Desktop
link on the webpage for your fork (repository).</p>
</li>
</ul>
</div>
<div class="section" id="installing-and-configuring-postgresql">
<h3>Installing and configuring PostgreSQL<a class="headerlink" href="#installing-and-configuring-postgresql" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ubuntu-14-04-distribution-instructions">
<h4>Ubuntu 14.04 distribution instructions<a class="headerlink" href="#ubuntu-14-04-distribution-instructions" title="Permalink to this headline">¶</a></h4>
<p>You can check PostgreSQL installation manual for linux on official PostgreSQL <a class="reference external" href="http://www.postgresql.org/download/linux/ubuntu/">page</a>.</p>
<p>Steps to install PostgreSQL on Ubuntu machine:</p>
<ul>
<li><p class="first">Create the file <code class="docutils literal"><span class="pre">/etc/apt/sources.list.d/pgdg.list</span></code>, and
add a line for the repository</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>deb http://apt.postgresql.org/pub/repos/apt/ trusty-pgdg main
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Import the repository signing key, and update the package lists</p>
<div class="highlight-python"><div class="highlight"><pre>wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | \
  sudo apt-key add -
sudo apt-get update
</pre></div>
</div>
</li>
<li><p class="first">Install postgres-9.4:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo apt-get install postgresql-9.4
</pre></div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>On Ubuntu-like distros, you must first install postgresql-server-dev-9.4
as a dependency to python psycopg2 package, <em>before</em> running <cite>pip install</cite> below:</p>
<div class="last highlight-python"><div class="highlight"><pre>sudo apt-get install postgresql-server-dev-9.4
</pre></div>
</div>
</div>
<ul>
<li><p class="first">Next we need to set default postgres user password to start development process:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo -u postgres psql postgres
postgres=# \password postgres
</pre></div>
</div>
</li>
<li><p class="first">Now we can exit from PostgreSQL and start to configure our Django project to use created database:</p>
<div class="highlight-python"><div class="highlight"><pre>postgres=# \q
</pre></div>
</div>
</li>
<li><p class="first">But one more thing we need to do is to open pg_hba.conf file:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo vim /etc/postgresql/9.4/main/pg_hba.conf
</pre></div>
</div>
</li>
<li><p class="first">And change:</p>
<div class="highlight-python"><div class="highlight"><pre>local   all    postgres    peer
</pre></div>
</div>
<p>to:</p>
<div class="highlight-python"><div class="highlight"><pre>local   all    postgres    md5
</pre></div>
</div>
</li>
<li><p class="first">Finally we need to restart PostgreSQL server:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo service postgresql restart
</pre></div>
</div>
</li>
</ul>
<p>In case when you don&#8217;t want to have the PostgreSQL server running all the time on your computer, just to play with the Socraticqs2 code (e.g. this consumes system resources), you can start and stop PostgreSQL manually:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo service postgresql stop
sudo service postgresql start
</pre></div>
</div>
<p>There are couple of ways to prevent PostgreSQL to start on system boot:</p>
<ol class="arabic">
<li><p class="first">First one is to remove system start-up links for postgres:</p>
<div class="highlight-python"><div class="highlight"><pre>✗ sudo update-rc.d -f postgresql remove
  Removing any system startup links for /etc/init.d/postgresql ...
    /etc/rc0.d/K21postgresql
    /etc/rc1.d/K21postgresql
    /etc/rc2.d/S19postgresql
    /etc/rc3.d/S19postgresql
    /etc/rc4.d/S19postgresql
    /etc/rc5.d/S19postgresql
    /etc/rc6.d/K21postgresql
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>In this case we can use default way to start postgres manually:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo service postgresql start
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">Second one is to change line <code class="docutils literal"><span class="pre">auto</span></code> to <code class="docutils literal"><span class="pre">manual</span></code> in <code class="docutils literal"><span class="pre">/etc/postgresql/9.4/main/start.conf</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Automatic startup configuration</span>
<span class="c"># auto: automatically start/stop the cluster in the init script</span>
<span class="c"># manual: do not start/stop in init scripts, but allow manual startup with</span>
<span class="c">#         pg_ctlcluster</span>
<span class="c"># disabled: do not allow manual startup with pg_ctlcluster (this can be easily</span>
<span class="c">#           circumvented and is only meant to be a small protection for</span>
<span class="c">#           accidents).</span>

<span class="n">auto</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>In this case we prevent to start <code class="docutils literal"><span class="pre">main</span></code> postgres cluster and need to use next commands to <code class="docutils literal"><span class="pre">stop|start</span></code> pg_cluster:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo pg_ctlcluster 9.4 main stop
sudo pg_ctlcluster 9.4 main start
</pre></div>
</div>
</div></blockquote>
<p>More information you can find on PostgreSQL 9.4 <a class="reference external" href="http://www.postgresql.org/docs/9.4/static/">documentation</a> page.</p>
</div>
<div class="section" id="mac-os-x-installation">
<h4>Mac OS X installation<a class="headerlink" href="#mac-os-x-installation" title="Permalink to this headline">¶</a></h4>
<p>For installing PostgreSQL on Mac OS X please follow the official <a class="reference external" href="http://www.postgresql.org/download/macosx/">instructions</a>.</p>
<p>One of the prefered way to install PostreSQL is <a class="reference external" href="http://brew.sh">Homebrew</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>brew install postgres
</pre></div>
</div>
<p>Postgres will be installed into <code class="docutils literal"><span class="pre">/usr/local/var/postgres</span></code> directory.</p>
<p>Information about how to start Postgres you can find by following command:</p>
<div class="highlight-python"><div class="highlight"><pre>brew info postgres
</pre></div>
</div>
<p>By default Homebrew create postgres role with name as your mac username.</p>
<p>So you need to set a password for this role:</p>
<div class="highlight-python"><div class="highlight"><pre>psql postgres
\password your_username
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuring-django-project-for-using-postgresql">
<h3>Configuring Django project for using PostgreSQL<a class="headerlink" href="#configuring-django-project-for-using-postgresql" title="Permalink to this headline">¶</a></h3>
<p>To configure project you need to copy <code class="docutils literal"><span class="pre">mysite/settings/local_conf_example.py</span></code> into <code class="docutils literal"><span class="pre">mysite/settings/local_conf.py</span></code> and change DATABASES dict according to previously configured PostgreSQL user and db_name:</p>
<div class="highlight-python"><div class="highlight"><pre>DATABASES = {
    &#39;default&#39;: {
      &#39;ENGINE&#39;: &#39;django.db.backends.postgresql_psycopg2&#39;,
      &#39;NAME&#39;: &#39;db_name&#39;,
      &#39;USER&#39;:  &#39;your_username&#39;, (postgres for Ubuntu default configuration proccess)
      &#39;PASSWORD&#39;: &#39;your_postgres_pass&#39;,
      &#39;HOST&#39;: &#39;&#39;,  # leave blank for localhost
      &#39;PORT&#39;: &#39;&#39;,  # leave blank for localhost
    }
}
</pre></div>
</div>
</div>
<div class="section" id="installing-required-python-packages-using-pip">
<h3>Installing required Python Packages using pip<a class="headerlink" href="#installing-required-python-packages-using-pip" title="Permalink to this headline">¶</a></h3>
<p>Assuming you have the above pre-requisites installed, within the
<cite>socraticqs2</cite> directory run the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install -r dev_requirements.txt
</pre></div>
</div>
</div>
<div class="section" id="run-the-test-suite">
<h3>Run the test suite<a class="headerlink" href="#run-the-test-suite" title="Permalink to this headline">¶</a></h3>
<p>To make sure your setup is working properly, try running the
test suite:</p>
<div class="highlight-python"><div class="highlight"><pre>cd socraticqs2/mysite
python manage.py test
</pre></div>
</div>
<p>You should see a series of tests pass successfully.</p>
<p>By default test suite is running on sqlite database to get a speed boost but you can change this by commenting out next lines in you local_conf.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="s">&#39;test&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s">&#39;test_coverage&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
    <span class="n">DATABASES</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">][</span><span class="s">&#39;ENGINE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;django.db.backends.sqlite3&#39;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>For Mac developer if you see <code class="docutils literal"><span class="pre">ValueError:</span> <span class="pre">unknown</span> <span class="pre">locale:</span> <span class="pre">UTF-8</span></code> do the following:</p>
<div class="highlight-python"><div class="highlight"><pre>export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8
</pre></div>
</div>
<p class="last">Or add this lines to your <code class="docutils literal"><span class="pre">~/.bash_profile</span></code></p>
</div>
</div>
<div class="section" id="running-a-test-web-server">
<h3>Running a test web server<a class="headerlink" href="#running-a-test-web-server" title="Permalink to this headline">¶</a></h3>
<p>You need to create a database, load it with some data,
load plugin specifications, and then
run the development web server.</p>
<p>You can prepare database with <a class="reference internal" href="fab.html"><em>Fabric deployment tool</em></a>.</p>
<p>To initialize DB to run test webserver use:</p>
<div class="highlight-python"><div class="highlight"><pre>fab db.init
</pre></div>
</div>
<p>This task creates a new DB and transforms it into working state by the next steps:</p>
<ul class="simple">
<li>Drop existing DB</li>
<li>Create new DB</li>
<li>Apply all current Django migrations</li>
<li>Load fixtures</li>
<li>Deploy all FSMs</li>
</ul>
<p>To list all available tasks use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fab</span> <span class="o">--</span><span class="nb">list</span>
</pre></div>
</div>
<p>Finally, start up the development web server:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py runserver
</pre></div>
</div>
<p>Start a web browser and point it at <a class="reference external" href="http://localhost:8000/ct/">http://localhost:8000/ct/</a></p>
<p>It will prompt you to log in; the default development tester
username is <code class="docutils literal"><span class="pre">admin</span></code> with password <code class="docutils literal"><span class="pre">testonly</span></code>.</p>
<p>User <cite>admin</cite> is a conventional user to use during the FSM development.</p>
<p>You can stop the web server by simply typing Control-C.</p>
<p>Security notes:</p>
<ul class="simple">
<li>you should not allow any outside access to localhost port 8000
as this is insecure (e.g. an outsider could log in with the default
credentials above and modify data in your development server).</li>
</ul>
</div>
</div>
<div class="section" id="basic-developer-operations">
<h2>Basic Developer Operations<a class="headerlink" href="#basic-developer-operations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="getting-source-code-updates-making-changes-etc">
<h3>Getting source code updates, making changes etc.<a class="headerlink" href="#getting-source-code-updates-making-changes-etc" title="Permalink to this headline">¶</a></h3>
<p>See our <a class="reference internal" href="gitguide.html"><em>Git Usage Guide</em></a>.</p>
</div>
<div class="section" id="database-operations">
<h3>Database Operations<a class="headerlink" href="#database-operations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="updating-your-database-schema">
<h4>Updating your database schema<a class="headerlink" href="#updating-your-database-schema" title="Permalink to this headline">¶</a></h4>
<p>If upstream code changes (i.e. made by someone else, and pulled
into your local repo) alter the database schema, you will have to
update your developer database to match.  You will typically notice this
in two ways:</p>
<ul class="simple">
<li>upstream code changes introduced new migration files in <code class="docutils literal"><span class="pre">ct/migrations/</span></code>.
These files tell Django how to update your database schema.</li>
<li>when you try to run the testsuite or <code class="docutils literal"><span class="pre">runserver</span></code>, you will get
an error message saying that your database schema does not match
the current data models.</li>
</ul>
<p>To migrate your database to the new schema, type:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py migrate ct
</pre></div>
</div>
</div>
<div class="section" id="altering-the-database-schema-models-yourself">
<h4>Altering the database schema (models) yourself<a class="headerlink" href="#altering-the-database-schema-models-yourself" title="Permalink to this headline">¶</a></h4>
<p>If you change the database fields for a data model in <code class="docutils literal"><span class="pre">models.py</span></code>,
you will of course also have to change your database to match.
(Note that this means changes to the data fields that are
stored in the database; changing or adding method code on
the data classes does not change the database schema).</p>
<p>Django 1.7 makes this easy via its <code class="docutils literal"><span class="pre">makemigrations</span></code> command.</p>
<p>First make a backup copy of your current database (this is important,
because it&#8217;s not obvious whether there is any easy way to &#8220;undo&#8221; a migration):</p>
<div class="highlight-python"><div class="highlight"><pre>fab db.backup[:custom_branch_name]
</pre></div>
</div>
<p>It will create db backup file with suffix from you current git branch name
or from provided optional param <code class="docutils literal"><span class="pre">custom_branch_name</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>fab db.backup:test1
.................
[localhost] local: pg_dump courselets -U postgres -w &gt; /path/to/proj/backups/backup.engine.test1
[................

Done.
</pre></div>
</div>
<p>Then simply type:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py makemigrations ct
</pre></div>
</div>
<p>This will create a new migration file in <code class="docutils literal"><span class="pre">ct/migrations</span></code>.  You then apply
this migration to your database exactly as we did in the previous section:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py migrate ct
</pre></div>
</div>
<p>At this point you should be able to run the <code class="docutils literal"><span class="pre">runserver</span></code>, etc.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>You must commit your new migration file at the same time
as you commit your schema changes in <code class="docutils literal"><span class="pre">models.py</span></code>, so that others can
update their database to match the new models.  E.g. using command-line
Git, you&#8217;d type something like:</p>
<div class="highlight-python"><div class="highlight"><pre>git add ct/models.py
git add ct/migrations/0005_unitstatus.py
git commit -m &#39;added UnitStatus to models&#39;
</pre></div>
</div>
<p class="last">where <code class="docutils literal"><span class="pre">ct/migrations/0005_unitstatus.py</span></code> is the new migration file
created by <code class="docutils literal"><span class="pre">makemigrations</span></code> to represent the changes you made to
<code class="docutils literal"><span class="pre">models.py</span></code>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>There are several limitations that make migrations somewhat unwieldy.
You need to be aware of the following &#8220;gotchas&#8221; lurking here:</p>
<ul class="last simple">
<li>once you change a model in <code class="docutils literal"><span class="pre">models.py</span></code>, your code will no longer
run until you successfully run <code class="docutils literal"><span class="pre">makemigrations</span></code> + <code class="docutils literal"><span class="pre">migrate</span></code>.
So you cannot actually move to manual testing your changes until
you run both those steps.</li>
<li>every time you run <code class="docutils literal"><span class="pre">makemigrations</span></code> on another change to
your data models, ANOTHER migration file
will be added, and EVERY migration file will be
required for the migration to work.
Multiple migration files increase the risk of errors either in
your committing them or other people attempting to apply them.
So ideally, when you change the models to introduce a new feature,
you want that to be represented by a single new migration file.</li>
<li>Because of this, in theory you shouldn&#8217;t
run <code class="docutils literal"><span class="pre">makemigrations</span></code> / <code class="docutils literal"><span class="pre">migrate</span></code> until
<em>after</em> you are pretty sure your model changes are final.
But you can&#8217;t even start manual testing of your changes until after
both steps.
This is an unpleasant catch-22.</li>
<li>To run unittests you need to create migration according to your new
code with no need to apply them to DB because test suite applies all
migrations every time you run it to temporary DB.</li>
<li>Once you change your database schema (via <code class="docutils literal"><span class="pre">migrate</span></code>), all <em>other</em>
code versions (i.e. not matching the new schema stored in your
database) will NOT run.
This would destroy the key virtue of Git &#8211; your ability to
have many different code branches and switch between them
effortlessly.</li>
<li>Because of this, to make developer life easier, we provide Fabriс <code class="docutils literal"><span class="pre">db.init|db.backup|db.restore</span></code>
tasks to init, backup and restore actions with DB. See <a class="reference internal" href="fab.html"><em>Fabric deployment tool</em></a> section
for details.</li>
</ul>
</div>
</div>
<div class="section" id="recommended-migration-best-practices">
<h4>Recommended Migration Best Practices<a class="headerlink" href="#recommended-migration-best-practices" title="Permalink to this headline">¶</a></h4>
<p>For all these reasons, I suggest you follow a simple discipline
whenever you are about to make model changes that will require
migration:</p>
<ul>
<li><p class="first">BEFORE making those changes, make your DB backup and
checkout a <em>new</em> Git branch, e.g.:</p>
<p>Make DB backup:</p>
<div class="highlight-python"><div class="highlight"><pre>fab db.backup
</pre></div>
</div>
<p>By default without providing any custom params to task it  will use
you current branch name as suffix for backup file.</p>
<p>Next you can checkput to new bigchange:</p>
<div class="highlight-python"><div class="highlight"><pre>git checkout -b bigchange
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">bigchange</span></code> is the name of your new branch.</p>
<p>You should also do this if you are starting to work with
someone else&#8217;s experimental model changes, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>fab db.backup
git checkout -b bigchange
git pull fred bigchange
</pre></div>
</div>
<p>Then, if you ever want to switch back to your <code class="docutils literal"><span class="pre">previous</span></code>
branch, you can simply switch back to the database file
that worked with <code class="docutils literal"><span class="pre">previous</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>git checkout previous
</pre></div>
</div>
<p>Next you need to restore backuped DB:</p>
<div class="highlight-python"><div class="highlight"><pre>fab db.restore
</pre></div>
</div>
<p>Note that you should NOT add any DB file to Git
version control.</p>
</li>
<li><p class="first">Now you can freely run <code class="docutils literal"><span class="pre">makemigrations</span></code> + <code class="docutils literal"><span class="pre">migrate</span></code>
whenever you like, so you can test your changes.</p>
</li>
<li><p class="first">If you DB is in initial state without any new information stored in
you can use <a class="reference internal" href="fab.html"><em>Fabric deployment tool</em></a> to get DB ready to test and development:</p>
<div class="highlight-python"><div class="highlight"><pre>$ fab db.init
</pre></div>
</div>
<p>This will give you a new DB with all migrations applied,
initial data populated and all FSM deployed.</p>
</li>
<li><p class="first">If it turns out that you need to make <em>more</em> model
changes (i.e. your model changes turned out to be inadequate
for the feature you&#8217;re implementing, and you haven&#8217;t yet committed
the inadequate models/migration),
the best practice is to UNDO your migration
and REGENERATE a new migration to replace it, like this:</p>
<div class="highlight-python"><div class="highlight"><pre>rm ct/migrations/0005_unitstatus.py
fab db.restore
python manage.py makemigrations ct
python manage.py migrate ct
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">ct/migrations/0005_unitstatus.py</span></code> is your new
migration file.</p>
<p>If you migration can be backwarded you can use next flow:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py migrate ct 0004
rm ct/migrations/0005_unitstatus.py
python manage.py makemigrations ct
python manage.py migrate ct
</pre></div>
</div>
<p>where 0004 is a number of your previous migration file.</p>
</li>
</ul>
</div>
<div class="section" id="backing-up-flushing-and-restoring-your-local-database">
<h4>Backing up, flushing, and restoring your local database<a class="headerlink" href="#backing-up-flushing-and-restoring-your-local-database" title="Permalink to this headline">¶</a></h4>
<p>You may wish to make and reload snapshots of your local database
as part of your development and testing process.  This is easy.</p>
<p>You can save a snapshot of your current database to a file, like this:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py dumpdata &gt; dumpdata/mysnap.json
</pre></div>
</div>
<p>You can flush (delete all data) from your database like this:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py sqlflush|python manage.py dbshell
</pre></div>
</div>
<p>You can then restore a particular snapshot like this:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py loaddata dumpdata/mysnap.json
</pre></div>
</div>
</div>
<div class="section" id="test-project-on-postgresql-before-making-any-pr">
<h4>Test project on PostgreSQL before making any PR<a class="headerlink" href="#test-project-on-postgresql-before-making-any-pr" title="Permalink to this headline">¶</a></h4>
<p>You can develop project using sqlite db but before creating
any PR you need to init PostgreSQL DB to ensure
your code not breaking anything.</p>
<ul>
<li><p class="first">You can create and populate db with <a class="reference internal" href="fab.html"><em>Fabric deployment tool</em></a>:</p>
<div class="highlight-python"><div class="highlight"><pre>fab db.init
</pre></div>
</div>
</li>
</ul>
<p>This will create and populate db with fixture. Then deploy all FSMs.</p>
<ul>
<li><p class="first">Run all tests:</p>
<div class="highlight-python"><div class="highlight"><pre>python manage.py test
</pre></div>
</div>
</li>
<li><p class="first">Run test server and start Course from home page.</p>
</li>
<li><p class="first">Go to Activity Page and restore Activity.</p>
</li>
<li><p class="first">Go to Activity Page and cancel Activity.</p>
</li>
</ul>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Getting Started with Socraticqs2 Development</a><ul>
<li><a class="reference internal" href="#installation-and-setup">Installation and setup</a><ul>
<li><a class="reference internal" href="#recommended-use-virtualenv-to-create-an-isolated-test-environment">Recommended: use virtualenv to create an isolated test environment</a></li>
<li><a class="reference internal" href="#pre-requisites">Pre-requisites</a></li>
<li><a class="reference internal" href="#installing-git-version-control-software">Installing Git version control software</a></li>
<li><a class="reference internal" href="#getting-the-socraticqs2-source-code">Getting the Socraticqs2 source code</a></li>
<li><a class="reference internal" href="#installing-and-configuring-postgresql">Installing and configuring PostgreSQL</a><ul>
<li><a class="reference internal" href="#ubuntu-14-04-distribution-instructions">Ubuntu 14.04 distribution instructions</a></li>
<li><a class="reference internal" href="#mac-os-x-installation">Mac OS X installation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-django-project-for-using-postgresql">Configuring Django project for using PostgreSQL</a></li>
<li><a class="reference internal" href="#installing-required-python-packages-using-pip">Installing required Python Packages using pip</a></li>
<li><a class="reference internal" href="#run-the-test-suite">Run the test suite</a></li>
<li><a class="reference internal" href="#running-a-test-web-server">Running a test web server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-developer-operations">Basic Developer Operations</a><ul>
<li><a class="reference internal" href="#getting-source-code-updates-making-changes-etc">Getting source code updates, making changes etc.</a></li>
<li><a class="reference internal" href="#database-operations">Database Operations</a><ul>
<li><a class="reference internal" href="#updating-your-database-schema">Updating your database schema</a></li>
<li><a class="reference internal" href="#altering-the-database-schema-models-yourself">Altering the database schema (models) yourself</a></li>
<li><a class="reference internal" href="#recommended-migration-best-practices">Recommended Migration Best Practices</a></li>
<li><a class="reference internal" href="#backing-up-flushing-and-restoring-your-local-database">Backing up, flushing, and restoring your local database</a></li>
<li><a class="reference internal" href="#test-project-on-postgresql-before-making-any-pr">Test project on PostgreSQL before making any PR</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to Socraticqs2&#8217;s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="fsm.html"
                        title="next chapter">Writing Guided Activities (Finite State Machines)</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/devintro.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="fsm.html" title="Writing Guided Activities (Finite State Machines)"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to Socraticqs2’s documentation!"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Socraticqs2 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Christopher Lee.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>